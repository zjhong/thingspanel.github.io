---
sidebar_position: 4
---

# ThingsPanel高并发测试报告

## 核心结论

基于本次测试结果，ThingsPanel新架构在1万台设备并发接入的场景下表现出色：

- 单集群支持25000/秒的数据写入，CPU峰值利用率维持在82%以下
- 在高并发下系统各项指标稳定，数据处理无延迟积压
- 基于当前硬件配置，预计可支持40万设备同时接入（按每分钟单设备4个数据点计算）

## 1. 测试背景与目的

为验证新架构下系统的并发处理能力，搭建了三节点集群环境进行压力测试。本次测试重点关注：

- 系统在高并发环境下的数据处理能力与稳定性
- 集群架构下的资源利用效率
- 系统扩展潜力评估

## 2. 测试环境

### 服务器配置

| 机型     | CPU                                           | 内存 | 硬盘                      | 说明                                            |
|----------|-----------------------------------------------|------|---------------------------|-------------------------------------------------|
| 云服务器1 | Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz 4核 | 8GB  | ESSD云盘 PL0 40GiB (2280 IOPS) | Cassandra数据库、VerneMQ、数据库和broker的插件应用 |
| 云服务器2 | Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz 4核 | 8GB  | ESSD云盘 PL0 40GiB (2280 IOPS) | Cassandra数据库、VerneMQ、数据库和broker的插件应用 |
| 云服务器3 | Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz 4核 | 8GB  | ESSD云盘 PL0 40GiB (2280 IOPS) | 应用平台、TimescaleDB、负载均衡器、测试脚本等       |

### 测试参数设置

- 设备数量：分别以5000台和10000台设备进行测试
- 数据上报频率：每台设备每6.4秒推送16个数据点
- 测试持续时间：持续运行24小时以验证系统稳定性

## 3. 测试结果

### 性能指标数据

| 设备数量 | 写入速度 | CPU使用率（%） | 内存使用率（%） | 内网带宽 | 云盘读写BPS |
|----------|----------|-----------------|-----------------|----------|-------------|
| 5000台   | 12000/s  | 36 / 37 / 40    | 35 / 37 / 17    | 25M      | 38M         |
| 10000台  | 25000/s  | 72 / 73 / 82    | 45 / 48 / 17    | 48M      | 76M         |

### 系统稳定性表现

- 数据处理能力：单集群实现25000/秒的持续稳定写入
- 响应时间：Web操作平均响应时间维持在200ms以内
- 队列状态：测试期间broker队列数据处理实时，无积压
- 查询性能：历史数据查询平均响应时间<500ms

## 4. 分析与结论

### 性能分析

1. 数据处理能力
   - 在1万设备并发场景下，系统维持25000/秒的写入速度，CPU使用率峰值82%，说明系统仍有性能余量
   - 数据写入与查询无延迟，表明系统的数据处理管道设计合理

2. 资源利用效率
   - CPU利用率随设备数量增加呈线性增长，从5000设备时的40%增至1万设备时的82%
   - 内存使用率增幅较小（17%→48%），显示内存管理优化效果良好
   - 磁盘IO从38M增加到76M，未达到ESSD云盘性能上限

3. 网络传输效率
   - 内网带宽占用从25M增长到48M，增长比例与设备数量基本匹配
   - 网络延迟稳定在个位数毫秒级别，说明集群间通信高效

### 扩展性评估

基于测试数据，对系统扩展性进行了如下评估：

1. 单集群容量：按每分钟单设备4个数据点计算，当前配置理论上可支持40万设备接入
2. 横向扩展：通过增加节点，预计系统可线性扩展至百万级设备规模
3. 资源瓶颈：当前配置下，CPU使用率是最先达到瓶颈的资源，建议后续扩容优先提升CPU配置

## 5. 改进建议

1. 硬件优化
   - 建议升级CPU核心数至8核，以提供更充足的计算资源
   - 考虑使用更高性能的ESSD云盘，为未来数据量增长预留空间

2. 软件优化
   - 优化数据写入批处理机制，减少CPU消耗
   - 实现智能负载均衡，提高集群资源利用率
   - 增强监控告警机制，提前预警潜在瓶颈

## 结论

测试表明，ThingsPanel架构具备优秀的并发处理能力和可扩展性。在中等硬件配置下，单集群可稳定支持万级设备接入，为未来支撑更大规模物联网应用奠定了基础。系统在设备数量倍增的情况下，仍保持线性的资源消耗增长，这验证了架构设计的合理性和效能。后续可通过优化资源配置和软件架构，进一步提升系统性能。
